<!DOCTYPE html>
<html>
<head>
    <title>User Information Form</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/21cb155038.js" crossorigin="anonymous"></script>
</head>
<body class="font-poppins">
    <div class="flex">
        <!-- Sidebar -->
        <div class="bg-indigo-600 w-72 flex flex-col justify-between h-screen p-2">
            <div>
                <h2 class="font-black p-2 tracking-wide text-2xl text-white">Face Recognition</h2>

                <ul class="space-y-4 mt-14 text-lg font-poppins">
                    <!-- Dashboard -->
                    <li class="text-white font-semibold rounded-lg p-3 hover:bg-indigo-700 transition">
                        <a href="/dashboard" class="block">
                            <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
                        </a>
                    </li>
                    <!-- Add a student -->
                    <li class="text-white font-semibold rounded-lg p-3 hover:bg-indigo-700 transition">
                        <a href="/add_prsn" class="block">
                            <i class="fas fa-user-plus mr-3"></i> Add a student
                        </a>
                    </li>
                    <!-- Record Attendance -->
                    <li class="text-white font-semibold rounded-lg p-3 hover:bg-indigo-700 transition">
                        <a href="/fr_page" class="block">
                            <i class="fas fa-clipboard-list mr-3"></i> Record Attendance
                        </a>
                    </li>
                    <!-- Edit Profile -->
                    <li class="text-white font-semibold rounded-lg p-3 hover:bg-indigo-700 transition">
                        <a href="/edit_profile" class="block">
                            <i class="fas fa-user-edit mr-3"></i> Edit Profile
                        </a>
                    </li>
                </ul>
            </div>
            <form action="/logout" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit"
                    class="text-white text-lg font-semibold hover:bg-indigo-700 w-full rounded-lg py-2 px-3 text-left transition">
                    <i class="fa-solid fa-arrow-right-from-bracket mr-3"></i>Logout
                </button>
            </form>
        </div>

        <!-- Main Content -->
        <div class="w-full flex h-screen items-center justify-center">
            <form id="userForm" method="POST" class="rounded pt-6 pb-8 mb-4" enctype="multipart/form-data" >
                <h1 class="text-3xl font-bold text-center mb-6">Add a Student</h1>
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <!-- Step 1: Collect Information -->
                <div id="step1" style="width:350px;">
                    <div class="mb-4">
                    <label class="block text-gray-900 text-sm font-bold mb-2" for="name">
                        Name:
                    </label>
                    <input class="shadow border-gray-400 appearance-none border-2 rounded w-full py-2 px-3 text-black leading-tight focus:outline-none focus:border-gray-600"
                        id="name" name="name" type="text" placeholder="Name"  required>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-900 text-sm font-bold mb-2" for="course">
                        Course:
                    </label>
                    <input class="shadow border-gray-400 appearance-none border-2 rounded w-full py-2 px-3 text-black leading-tight focus:outline-none focus:border-gray-600"
                        id="course" name="course" placeholder="Course"  type="text" required>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-900 text-sm font-bold mb-2" for="email">
                        Email Address:
                    </label>
                    <input class="shadow border-gray-400 appearance-none border-2 rounded w-full py-2 px-3 text-black leading-tight focus:outline-none focus:border-gray-600"
                        id="email" name="email" type="email" placeholder="Enter email address" required>
                </div>

                <div class="mb-4">
                    <h3 class="block text-gray-900 text-sm font-bold mb-2">Gender:</h3>
                    <div class="gender-option flex gap-3">
                        <!-- First Gender Option: Male -->
                        <div class="flex items-center">
                            <input type="radio" id="check-male" name="gender" value="Male" checked class="mr-2">
                            <label for="check-male">Male</label>
                        </div>

                        <!-- Second Gender Option: Female -->
                        <div class="flex items-center">
                            <input type="radio" id="check-female" name="gender" value="Female" class="mr-2">
                            <label for="check-female">Female</label>
                        </div>

                        <!-- Third Gender Option: Prefer not to say -->
                        <div class="flex items-center">
                            <input type="radio" id="check-other" name="gender" value="Prefer not to say" class="mr-2">
                            <label for="check-other">Other</label>
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-900 text-sm font-bold mb-2" for="date_of_birth">Date of birth:</label>
                    <input type="date" class="shadow border-gray-400 appearance-none border-2 rounded w-full py-2 px-3  text-black leading-tight" id="date_of_birth" name="date_of_birth" placeholder="Enter date of birth" required />
                </div>
                <div class="flex w-full justify-between">
                    <div class="mb-4 basis-1/2">
                        <label class="block text-gray-900 text-sm font-bold mb-2" for="year">
                            Year:
                        </label>
                        <input class="shadow border-gray-400 appearance-none border-2 rounded w-24 py-2 px-3 text-black leading-tight focus:outline-none focus:border-gray-600"
                            id="year" name="year" type="number" min="1" max="4" required>
                    </div>

                    <div class="mb-4 basis-1/2">
                        <label class="block text-gray-900 text-sm font-bold mb-2" for="student_id">
                            Student ID:
                        </label>
                        <input class="shadow border-gray-400 appearance-none border-2 rounded w-56 py-2 px-3  text-black leading-tight focus:outline-none focus:border-gray-600"
                            id="student_id" name="student_id" min="6" max="10" type="text" required>
                    </div>
                </div>

                    <!-- Add other fields as needed for Step 1 -->

                    <div class="flex items-center justify-between">
                        <button type="button" onclick="nextStep(1, 2)"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 w-full rounded focus:outline-none focus:shadow-outline">
                            Next
                        </button>
                    </div>
                </div>

                <!-- Step 2: Capture Image -->
                 <div id="step2" style="display: none;">
                    <div class="flex justify-center mb-4">
                        <div>
                            <h3>Uploaded Image:</h3>
                            <img id="uploadedImage" width="640" height="480" >
                        </div>
                    </div>

                    <div class="flex justify-center mb-4">
                        <!-- Replace video and canvas with file input for image upload -->
                        <input type="file" name="imageInput" id="imageInput" onchange="displayUploadedImage()" accept=".jpg, .jpeg, .png">
                    </div>

                    <div id="form-btn" class="flex items-center justify-between">
                        <button type="button" onclick="backToStep(2, 1)"
                            class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                            Back
                        </button>
                        <button type="submit"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                            Submit
                        </button>
                        <!-- The Submit button is dynamically added after capturing the image -->
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script>
        function nextStep(currentStep, nextStep) {
            const currentStepDiv = document.getElementById("step" + currentStep);
            const nextStepDiv = document.getElementById("step" + nextStep);

            if (currentStepDiv && nextStepDiv) {
                currentStepDiv.style.display = "none";
                nextStepDiv.style.display = "block";
            }
        }

        function backToStep(currentStep, prevStep) {
            const currentStepDiv = document.getElementById("step" + currentStep);
            const prevStepDiv = document.getElementById("step" + prevStep);

            if (currentStepDiv && prevStepDiv) {
                currentStepDiv.style.display = "none";
                prevStepDiv.style.display = "block";
            }
        }

        const formData = new FormData();

        async function displayUploadedImage() {
            try {
                const imageInput = document.getElementById('imageInput');
                const uploadedImage = document.getElementById('uploadedImage');

                if (imageInput.files && imageInput.files[0]) {
                    uploadedImage.src = URL.createObjectURL(imageInput.files[0]);
                    uploadedImage.style.display = 'block';
                }
            } catch (error) {
                console.error('Error displaying uploaded image: ', error);
            }
        }

    async function submitForm() {
        try {
            // Capture the image from the canvas
            const canvas = document.getElementById('canvas');
            const imageDataURL = canvas.toDataURL('image/jpeg');

            // Add the image data to the form data
            const formData = new FormData(document.getElementById('userForm'));
            formData.append('image_data', imageDataURL); // Add the image_data key to the form data

            // Create a hidden input field for CSRF token and add it to the form data
            const csrfToken = document.querySelector('input[name="csrf_token"]').value;
            formData.append('csrf_token', csrfToken);

            // Create a new form element to submit the form
            const formElement = document.createElement('form');
            formElement.method = 'post';
            formElement.action = '/add_prsn';
            formElement.style.display = 'none';

            // Append the form data to the new form element
            for (const [key, value] of formData.entries()) {
                const inputElement = document.createElement('input');
                inputElement.type = 'hidden';
                inputElement.name = key;
                inputElement.value = value;
                formElement.appendChild(inputElement);
            }

            // Append the new form element to the document and submit it
            document.body.appendChild(formElement);
            formElement.submit();
        } catch (error) {
            console.error('Error submitting the form: ', error);
        }
    }
</script>
</body>
</html>
